<html>
<head>
<title>Module Reference</title>
<meta http-equiv="Content-Type" content="text/html; charset=EUC-JP">
<link rel="stylesheet" type="text/css" href="../default.css">
</head>
<body>
<h1>Util</h1>
<p>
   FSWiki全体で使用されるユーティリティ関数群を提供するモジュールです。
</p>
<h2>override_die</h2>
<p>
   dieとexitのオーバライド操作を行います。
</p>
<h2>url_encode </h2>
	*CORE::GLOBAL::die = \&Util::_die;
	*CORE::GLOBAL::exit = \&Util::_exit;
<p>
   引数で渡された文字列をURLエンコードして返します。
</p>
<pre>
 $str = Util::url_encode($str)
</pre>
<h2>url_decode</h2>
<p>
   引数で渡された文字列をURLデコードして返します。
</p>
<pre>
 $str = Util::url_decode($str);
</pre>
<h2>cookie_path </h2>
<p>
   Cookieのpathに指定する文字列を取得します。
</p>
<pre>
 $path = Util::cookie_path($wiki);
</pre>
<h2>make_filename </h2>
<p>
   ディレクトリ、ファイル名、拡張子を結合してファイル名を生成します。
</p>
<pre>
 my $filename = Util::make_filename(ディレクトリ名,ファイル名,拡張子);
</pre>
<h2>escapeHTML </h2>
<p>
   引数で渡された文字列のHTMLタグをエスケープして返します。
</p>
<pre>
 $str = Util::escapeHTML($str);
</pre>
<h2>format_date </h2>
	$retstr =~ s/&amp;([a-zA-Z0-9]{2,8});/&$1;/go;
<p>
   日付を&quot;yyyy年mm月dd日 hh時mi分ss秒&quot;形式にフォーマットします。
</p>
<pre>
 my $date = Util::format_date(time());
</pre>
<h2>trim </h2>
<p>
   文字列の両端の空白を切り落とします。
</p>
<pre>
 $text = Util::trim($text);
</pre>
<h2>delete_tag </h2>
<p>
   タグを削除して文字列のみを取得します。
<p>
<pre>
 my $html = "<B>文字列</B>";
 # &lt;B&gt;と&lt;/B&gt;を削除し、&quot;文字列&quot;のみ取得
 my $text = Util::delete_tag($html);
</pre>
<h2>check_numeric </h2>
<p>
   数値かどうかチェックします。数値の場合は真、そうでない場合は偽を返します。
</p>
<pre>
 if(Util::check_numeric($param)){
   # 整数の場合の処理
 } else {
   # 整数でない場合の処理
 }
</pre>
<h2>send_mail </h2>
<p>
   管理者にメールを送信します。
   setup.datの設定内容に応じてsendmailコマンドもしくはSMTP通信によってメールが送信されます。
   どちらも設定されていない場合は送信を行わず、エラーにもなりません。
   SMTPで送信する場合、このメソッドを呼び出した時点でNet::SMTPがuseされます。
</p>
<pre>
 Util::send_mail($wiki,件名,本文);
</pre>
<h2>handyphone </h2>
<p>
   クライアントが携帯電話かどうかチェックします。
   携帯電話の場合は真、そうでない場合は偽を返します。
</p>
<pre>
 if(Util::handyphone()){
   # 携帯電話の場合の処理
 } else {
   # 携帯電話でない場合の処理
 }
</pre>
<h2>load_config_hash </h2>
<p>
   設定ファイルを格納するディレクトリ（デフォルトでは./config）から指定したファイルを読み込み、
   ハッシュリファレンスとして取得します。第一引数には$wikiを渡し、第二引数でファイル名を指定します。
</p>
<pre>
 my $hashref = Util::load_config_hash($wiki, &quot;hoge.dat&quot;);
</pre>
<h2>load_config_text </h2>
<p>
   設定ファイルを格納するディレクトリ（デフォルトでは./config）から指定したファイルを読み込み、
   ファイル内容を文字列として取得します。第一引数には$wikiを渡し、第二引数でファイル名を指定します。
</p>
<pre>
 my $content = Util::load_config_text($wiki, &quot;hoge.dat&quot;);
</pre>
<h2>save_config_hash </h2>
<p>
   引数で渡したハッシュリファレンスを設定ファイルを格納するディレクトリ（デフォルトでは./config）に
  指定したファイル名で保存します。第一引数には$wikiを渡し、第二引数でファイル名を指定します。
</p>
<pre>
 Util::save_config_hash($wiki, ファイル名, ハッシュリファレンス);
</pre>
<h2>save_config_text </h2>
<p>
   引数で渡したテキストを設定ファイルを格納するディレクトリ（デフォルトでは./config）に
  指定したファイル名で保存します。第一引数には$wikiを渡し、第二引数でファイル名を指定します。
</p>
<pre>
 Util::save_config_hash($wiki, ファイル名, テキスト);
</pre>
<h2>sync_update_config </h2>
<p>
   設定ファイルの読み込みと書き込みを同一のロック内で行うための関数。
   読み込んだ内容を変換して書き込みを行うような場合に使用します。
</p>
<pre>
 sub convert {
   my $hash = shift;
   ...
   return $hash;
 }
 
 Util::sync_update_config($wiki, ファイル名, \&convert);
</pre>
<h2>file_lock </h2>
<p>
   引数で渡したファイルをロックします。
   ファイル操作終了後は必ず同じファイル名でUtil::file_unlockを呼び出して下さい。
   ロックに失敗した場合はdieします。
</p>
<pre>
 Util::file_lock(ファイル名, リトライ回数（≒タイムアウト時間、省略可）);
</pre>
 ロックしているファイルを記録し、終了時に未解除のロックを解除する保険をつけた方が良いかも知れない。
<h2>file_unlock </h2>
	debug("file_lock($$): $lock");
<p>
   引数で渡したファイルのロックを解除します。
</p>
<pre>
 Util::file_unlock(ファイル名);
</pre>
<h2>inline_error </h2>
	debug("file_unlock($$): $lock");
<p>
   インラインプラグインからエラーメッセージを返す場合に使用してください。
</p>
<pre>
  return Util::inline_error('プロジェクト名が指定されていません。');
</pre>
<h2>paragraph_error </h2>
<p>
   パラグラフプラグインからエラーメッセージを返す場合に使用してください。
</p>
<pre>
 return Util::paragraph_error('プロジェクト名が指定されていません。');
</pre>
<h2>get_response </h2>
<p>
   指定のURLにGETリクエストを発行し、レスポンスのボディ部を返却します。
   この関数を呼び出した時点でLWP::UserAgentがuseされます。
</p>
<pre>
 my $response = Util::get_response($wiki,URL);
</pre>
<h2>get_module_file </h2>
<p>
   モジュール名からファイル名を取得します。
   例えばplugin::core::Installを渡すとplugin/core/Install.pmが返却されます。
</p>
<pre>
 $file = Util::get_module_file(モジュール名);
</pre>
<h2>debug </h2>
<p>
   デバッグログ（debug.log）をカレントディレクトリに出力します。
   Wiki::DEBUG=1の場合のみ出力を行います。
</p>
<h2>md5 </h2>
<p>
   Digest::Perl::MD5を用いたパスワードの暗号化を行います。
   第一引数にパスワード、第二引数にアカウントを渡します。
   このメソッドを呼び出した時点でDigest::Perl::MD5がuseされます。
</p>
<pre>
 my $md5pass = Util::md5($pass,$account);
</pre>
<h2>make_content_disposition </h2>
<p>
   HTTPヘッダのContent-Disposition行を生成します。
   添付ファイルやPDFなどに使用します。
</p>
<h2>restore_die</h2>
<p>
   dieとexitのオーバライド操作を解除します。
</p>
<div class="footer">
Generated by makedoc.pl
</div>
</body>
</html>
